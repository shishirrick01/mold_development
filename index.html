<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mold Master v9.0 (Smart Catalog)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8fafc; font-family: 'Segoe UI', sans-serif; color: #1e293b; }
        .input-label { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; color: #64748b; display: block; margin-bottom: 2px; }
        .tab-btn { padding: 12px 24px; font-weight: 600; color: #64748b; border-bottom: 3px solid transparent; transition: all 0.2s; }
        .tab-btn:hover { background-color: #f1f5f9; color: #334155; }
        .tab-btn.active { border-bottom: 3px solid #2563eb; color: #2563eb; background: white; }
        .spec-val { font-family: 'Roboto Mono', monospace; font-weight: 700; color: #0f172a; }
        .bom-table th { background: #e2e8f0; text-align: left; padding: 10px; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .bom-table td { border-bottom: 1px solid #e2e8f0; padding: 10px; font-size: 0.9rem; }
        .bom-table tr:hover { background-color: #f8fafc; }
        optgroup { color: #1e40af; font-weight: bold; background: #eff6ff; }
        option { color: #334155; background: white; padding: 4px; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-slate-900 text-white sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 p-2 rounded"><i class="fa-solid fa-industry text-xl"></i></div>
                <div>
                    <h1 class="text-lg font-bold">Mold<span class="text-blue-400">Master</span> v9.0</h1>
                    <p class="text-[10px] text-slate-400 uppercase">Product Catalog Logic</p>
                </div>
            </div>
            <button onclick="window.print()" class="bg-slate-800 hover:bg-slate-700 px-3 py-2 rounded text-xs border border-slate-700 flex items-center gap-2">
                <i class="fa-solid fa-print"></i> Print Report
            </button>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6 flex-grow">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- INPUTS -->
            <div class="lg:col-span-3 space-y-4">
                <form id="moldForm" onsubmit="calculateAll(event)" class="bg-white p-5 rounded-lg shadow-sm border border-slate-200 sticky top-24">
                    
                    <h2 class="text-sm font-bold border-b pb-2 mb-3 text-slate-800"><i class="fa-solid fa-list-check text-blue-600 mr-2"></i>Select Product</h2>
                    
                    <div class="mb-4">
                        <label class="input-label mb-1">Catalog Item</label>
                        <select id="productType" class="w-full text-sm border-2 border-blue-100 rounded p-2 bg-blue-50 focus:border-blue-500 outline-none cursor-pointer">
                            <option value="">-- Choose Product --</option>
                            
                            <optgroup label="Furniture">
                                <option value="wardrobe">Wardrobes (5D, Double, Single)</option>
                                <option value="closet">Closets & Cabinets (Amass, Royal)</option>
                                <option value="chair">Chairs (Arm, Decorator, Royal)</option>
                                <option value="table">Tables (Dining, Center, Reading)</option>
                                <option value="stool">Stools (Magic, Step, Net)</option>
                                <option value="sofa">Sofa Sets (Caino)</option>
                            </optgroup>

                            <optgroup label="Food & Beverage Storage">
                                <option value="container">Containers (Fresco, Moon, Thin Wall)</option>
                                <option value="jar">Air-Tight Jars (Deep Draw)</option>
                                <option value="lunchbox">Lunch & Tiffin Boxes</option>
                                <option value="bottle">Water Bottles (Phinix, Prism)</option>
                                <option value="jug">Jugs (Elegant, Crown)</option>
                            </optgroup>

                            <optgroup label="Household & Cleaning">
                                <option value="bucket">Buckets (Super, Mop, Deluxe)</option>
                                <option value="basket">Baskets (Laundry, Waste, Shopping)</option>
                                <option value="rack">Racks & Hangers</option>
                                <option value="dustbin">Paddle Bins & Dustbins</option>
                            </optgroup>

                            <optgroup label="Tableware & Kitchen">
                                <option value="dinner_set">Dinner & Tea Sets</option>
                                <option value="mug">Tumblers & Mugs</option>
                                <option value="tray">Trays (Rattan, Spice)</option>
                                <option value="kitchen_tool">Kitchen Tools (Strainers, Juicers)</option>
                            </optgroup>

                            <optgroup label="Babyware & Toys">
                                <option value="potty">Baby Potties & Baths</option>
                                <option value="toy">Toys & Riders</option>
                            </optgroup>

                            <optgroup label="Industrial">
                                <option value="pallet">Pallets (Heavy Duty)</option>
                                <option value="floor_mat">Heavy Floor Mats</option>
                            </optgroup>
                        </select>
                    </div>

                    <h2 class="text-sm font-bold border-b pb-2 mb-3 text-slate-800"><i class="fa-solid fa-ruler-combined text-orange-600 mr-2"></i>Dimensions</h2>
                    <div class="space-y-3 mb-6">
                        <div class="grid grid-cols-2 gap-2">
                            <div><label class="input-label">Length</label><input type="number" id="partL" required class="w-full text-sm border rounded p-1.5 bg-slate-50" placeholder="mm"></div>
                            <div><label class="input-label">Width</label><input type="number" id="partW" required class="w-full text-sm border rounded p-1.5 bg-slate-50" placeholder="mm"></div>
                            <div><label class="input-label">Height</label><input type="number" id="partH" required class="w-full text-sm border rounded p-1.5 bg-slate-50" placeholder="mm"></div>
                            <div><label class="input-label">Wall T</label><input type="number" id="wallT" value="2.0" step="0.1" class="w-full text-sm border rounded p-1.5 bg-slate-50"></div>
                        </div>
                        <div>
                            <label class="input-label">Material</label>
                            <select id="material" class="w-full text-sm border rounded p-1.5">
                                <option value="PP">PP (Polyprop)</option>
                                <option value="ABS">ABS</option>
                                <option value="PC">PC (Polycarb)</option>
                                <option value="PA66">Nylon 66</option>
                                <option value="HDPE">HDPE</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div><label class="input-label">Cavities</label><input type="number" id="cavities" value="1" class="w-full text-sm border rounded p-1.5"></div>
                            <div><label class="input-label">Steel Price</label><input type="number" id="steelPrice" value="220" class="w-full text-sm border rounded p-1.5" placeholder="Tk/kg"></div>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded shadow-lg uppercase text-sm flex justify-center items-center gap-2 transform active:scale-95 transition">
                        <i class="fa-solid fa-bolt"></i> Generate Full Design
                    </button>
                </form>
            </div>

            <!-- RESULTS -->
            <div class="lg:col-span-9">
                <!-- Welcome State -->
                <div id="welcomeState" class="h-full flex flex-col justify-center items-center bg-white rounded-lg border-2 border-dashed border-slate-300 text-slate-400 p-12">
                    <i class="fa-solid fa-list-ul text-6xl mb-4 text-slate-200"></i>
                    <h2 class="text-xl font-bold text-slate-500">Select Product</h2>
                    <p class="text-sm mt-2">Choose an item to load its Engineering Logic.</p>
                </div>

                <div id="resultsArea" class="hidden space-y-6">
                    
                    <!-- KPI Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-white p-4 rounded shadow border-l-4 border-blue-500">
                            <p class="text-xs text-blue-800 font-bold uppercase">Machine</p>
                            <p class="text-xl font-black text-slate-800" id="resMachine">--</p>
                            <p class="text-xs text-slate-400"><span id="resTonnage">--</span> Tons</p>
                        </div>
                        <div class="bg-white p-4 rounded shadow border-l-4 border-orange-500">
                            <p class="text-xs text-orange-800 font-bold uppercase">Cooling Logic</p>
                            <p class="text-lg font-black text-slate-800 leading-none mt-1" id="resCoolBadge">--</p>
                        </div>
                        <div class="bg-white p-4 rounded shadow border-l-4 border-teal-500">
                            <p class="text-xs text-teal-800 font-bold uppercase">Cycle Time</p>
                            <p class="text-xl font-black text-slate-800" id="resCycle">--</p>
                            <p class="text-xs text-slate-400">Seconds (Est)</p>
                        </div>
                        <div class="bg-white p-4 rounded shadow border-l-4 border-emerald-500">
                            <p class="text-xs text-emerald-800 font-bold uppercase">Steel Cost</p>
                            <p class="text-xl font-black text-slate-800" id="resCost">--</p>
                            <p class="text-xs text-slate-400">BDT (Est)</p>
                        </div>
                    </div>

                    <!-- TABS -->
                    <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden">
                        <div class="flex border-b bg-slate-50">
                            <button onclick="showTab('bom')" id="tab-bom" class="tab-btn active">BOM</button>
                            <button onclick="showTab('systems')" id="tab-systems" class="tab-btn">Smart Systems</button>
                            <button onclick="showTab('hardware')" id="tab-hardware" class="tab-btn">Hardware</button>
                            <button onclick="showTab('machine')" id="tab-machine" class="tab-btn">Machine</button>
                        </div>

                        <!-- TAB 1: BOM -->
                        <div id="content-bom" class="p-6">
                            <h3 class="font-bold text-slate-700 mb-4 flex items-center">
                                <i class="fa-solid fa-layer-group mr-2 text-slate-400"></i>9-Plate Mold Stack
                                <span class="ml-auto text-xs bg-slate-100 px-2 py-1 rounded text-slate-500">Base: <strong id="resBaseSize">--</strong></span>
                            </h3>
                            <div class="overflow-x-auto">
                                <table class="bom-table w-full">
                                    <thead><tr><th>Component</th><th>Material</th><th>Dimensions</th><th>Weight (kg)</th><th>Note</th></tr></thead>
                                    <tbody id="bomBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- TAB 2: SMART SYSTEMS (Logic Driven) -->
                        <div id="content-systems" class="p-6 hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                
                                <!-- Cooling Logic -->
                                <div class="relative">
                                    <div class="absolute -left-3 top-0 bottom-0 w-1 bg-teal-500 rounded-l"></div>
                                    <h4 class="font-bold text-teal-800 mb-3 ml-2">Product Cooling Logic</h4>
                                    <div class="bg-teal-50 p-4 rounded border border-teal-100 space-y-3">
                                        <div>
                                            <p class="text-xs uppercase text-teal-600 font-bold">System Type</p>
                                            <p class="text-lg font-bold text-slate-800" id="resCoolType">--</p>
                                        </div>
                                        <div>
                                            <p class="text-xs uppercase text-teal-600 font-bold">Engineering Reason</p>
                                            <p class="text-sm text-slate-600 italic" id="resCoolReason">--</p>
                                        </div>
                                        <hr class="border-teal-200">
                                        <div class="grid grid-cols-2 gap-2 text-sm">
                                            <div><span class="text-teal-700">Channel Dia:</span> <span class="font-bold" id="resCoolDia">--</span></div>
                                            <div><span class="text-teal-700">Offset:</span> <span class="font-bold" id="resCoolOff">--</span></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Feed & Ejection -->
                                <div class="space-y-6">
                                    <!-- Feed -->
                                    <div class="relative">
                                        <div class="absolute -left-3 top-0 bottom-0 w-1 bg-orange-500 rounded-l"></div>
                                        <h4 class="font-bold text-orange-800 mb-3 ml-2">Feed System</h4>
                                        <div class="bg-orange-50 p-4 rounded border border-orange-100">
                                            <div class="flex justify-between mb-2">
                                                <span class="font-bold text-slate-700" id="resGateType">--</span>
                                                <span class="logic-badge bg-orange-200 text-orange-800">Rec. Gate</span>
                                            </div>
                                            <p class="text-sm text-slate-600 mb-2" id="resGateReason">--</p>
                                            <div class="flex gap-4 text-sm text-slate-600">
                                                <span>Sprue: <strong id="resSprue">--</strong></span>
                                                <span>Runner: <strong id="resRunner">--</strong></span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Ejection -->
                                    <div class="relative">
                                        <div class="absolute -left-3 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                        <h4 class="font-bold text-blue-800 mb-3 ml-2">Ejection System</h4>
                                        <div class="bg-blue-50 p-4 rounded border border-blue-100">
                                            <div class="flex justify-between mb-2">
                                                <span class="font-bold text-slate-700" id="resEjectType">--</span>
                                                <span class="logic-badge bg-blue-200 text-blue-800">Logic</span>
                                            </div>
                                            <p class="text-sm text-slate-600 mb-2">Stroke: <span class="font-bold" id="resStroke">--</span> mm</p>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- TAB 3: HARDWARE -->
                        <div id="content-hardware" class="hidden p-6">
                            <h4 class="font-bold text-slate-700 mb-3 flex justify-between">
                                <span><i class="fa-solid fa-screw text-slate-500 mr-2"></i>Bolt Schedule (SHCS 12.9)</span>
                            </h4>
                            <div class="overflow-x-auto mb-6">
                                <table class="bom-table w-full">
                                    <thead><tr><th>Location</th><th>Spec</th><th>Qty</th><th>Tap</th><th>C-Bore</th></tr></thead>
                                    <tbody id="boltBody"></tbody>
                                </table>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div class="bg-blue-50 p-3 rounded">
                                    <p class="font-bold mb-1">Ejection Hardware</p>
                                    <p class="flex justify-between"><span>Pin Dia:</span> <strong id="resPinDia">--</strong></p>
                                    <p class="flex justify-between"><span>Qty:</span> <strong id="resPinQty">--</strong></p>
                                    <p class="flex justify-between"><span>Return Pins:</span> <strong id="resRetPin">--</strong></p>
                                </div>
                                <div class="bg-slate-50 p-3 rounded">
                                    <p class="font-bold mb-1">Mold Components</p>
                                    <p class="flex justify-between"><span>Guide Pins:</span> <strong id="resGuide">--</strong></p>
                                    <p class="flex justify-between"><span>Sprue Bush:</span> <strong>SR-20</strong></p>
                                    <p class="flex justify-between"><span>Loc Ring:</span> <strong>K12</strong></p>
                                </div>
                            </div>
                        </div>

                        <!-- TAB 4: MACHINE -->
                        <div id="content-machine" class="hidden p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-white p-4 border rounded shadow-sm">
                                    <h4 class="font-bold text-slate-700 mb-3">Machine Inventory Check</h4>
                                    <p class="text-3xl font-black text-slate-800 mb-1" id="resMachineBig">--</p>
                                    
                                    <div id="machineAlert" class="hidden mt-4 bg-red-50 text-red-700 p-3 rounded text-xs border border-red-200">
                                        <i class="fa-solid fa-triangle-exclamation mr-1"></i> <strong>Critical Warning:</strong> This product requires a machine larger than your 580T inventory (likely >1000T for Pallets/Wardrobes).
                                    </div>
                                </div>
                                
                                <div class="bg-white p-4 border rounded shadow-sm">
                                    <h4 class="font-bold text-slate-700 mb-3">Cost Breakdown</h4>
                                    <ul class="text-sm space-y-2">
                                        <li class="flex justify-between"><span>Core/Cavity (718H)</span> <span class="font-mono" id="costInsert">--</span></li>
                                        <li class="flex justify-between"><span>Mold Base (MS)</span> <span class="font-mono" id="costBase">--</span></li>
                                        <li class="flex justify-between font-bold pt-2 border-t text-lg"><span>Total</span> <span class="font-mono text-emerald-600" id="resCostBig">--</span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- CONSTANTS ---
        const MACHINES = [
            { name: "160T", ton: 160, bar: 450 }, { name: "250T", ton: 250, bar: 580 }, { name: "580T", ton: 580, bar: 900 }
        ];
        const MATERIALS = {
            "PP": { shrink: 1.5, dens: 0.9 }, "ABS": { shrink: 0.5, dens: 1.05 },
            "PC": { shrink: 0.6, dens: 1.2 }, "PA66": { shrink: 1.2, dens: 1.14 }, "HDPE": { shrink: 2.0, dens: 0.95 }
        };
        const BOLT_DATA = {
            "M8":  { tap: "6.8mm", cb: "15mm" }, "M10": { tap: "8.5mm", cb: "18mm" },
            "M12": { tap: "10.2mm", cb: "20mm" }, "M16": { tap: "14mm", cb: "26mm" }, "M20": { tap: "17.5mm", cb: "30mm" }
        };

        // --- PRODUCT LOGIC DB (THE BRAIN) ---
        const PROD_RULES = {
            // FURNITURE
            "wardrobe": { cool: "High Flow Serial Grid", reason: "Large surface area requires rapid, uniform heat removal.", gate: "Hot Runner (Valve)", gateReason: "Prevent cold slugs on large panel.", eject: "Pin Grid (High Density)" },
            "chair":    { cool: "Baffles (Legs) + Contour", reason: "Deep ribs in legs require baffles. Shell needs core cooling.", gate: "Direct Sprue", gateReason: "Center fill for balanced flow.", eject: "Stripper + Pins" },
            "table":    { cool: "High Flow Grid", reason: "Flat panel warping is critical. Uniform cooling needed.", gate: "Hot Runner", gateReason: "Minimizes flow length ratio.", eject: "Pin Grid" },
            "stool":    { cool: "Bubblers (Core)", reason: "Deep core requires bubblers to prevent hot spots.", gate: "Direct Sprue", gateReason: "Center fill.", eject: "Stripper Plate" },
            
            // STORAGE
            "container":{ cool: "High Speed Grid (BeCu)", reason: "Thin wall = fast cycle. Beryllium Copper corners recommended.", gate: "Pin-Point", gateReason: "Clean vestige for stacking.", eject: "Air Poppet + Stripper" },
            "jar":      { cool: "Bubblers (Core) + Helix", reason: "Deep cylindrical shape needs internal bubblers.", gate: "Pin-Point", gateReason: "Center fill.", eject: "Stripper Plate (Rim)" },
            "bottle":   { cool: "Sleeve Cooling", reason: "Neck cooling is critical for threads.", gate: "Submarine", gateReason: "Shears off automatically.", eject: "Unscrewing / Sleeve" },
            
            // HOUSEHOLD
            "bucket":   { cool: "Bubblers (Core Center)", reason: "Long core must be cooled internally to prevent warping.", gate: "Direct Sprue", gateReason: "Easy fill for deep part.", eject: "Air Poppet + Stripper" },
            "basket":   { cool: "Grid + Baffles", reason: "Complex mesh needs cooling in ribs.", gate: "Fan Gate", gateReason: "Reduces knit lines in mesh.", eject: "Pin Grid" },
            "dustbin":  { cool: "Bubblers (Core)", reason: "Deep core cooling.", gate: "Direct Sprue", gateReason: "Robust fill.", eject: "Stripper Plate" },

            // INDUSTRIAL
            "pallet":   { cool: "Max Flow (20mm Channels)", reason: "Massive heat load. Needs large turbulent flow.", gate: "Hot Runner (Multi-Tip)", gateReason: "Distribute flow across huge part.", eject: "Strong Return Pins" },
            
            // DEFAULT
            "default":  { cool: "Standard Grid", reason: "General purpose cooling.", gate: "Edge Gate", gateReason: "Simple and reliable.", eject: "Ejector Pins" }
        };

        function showTab(t) {
            ['bom','systems','hardware','machine'].forEach(x => {
                document.getElementById('content-'+x).classList.add('hidden');
                document.getElementById('tab-'+x).classList.remove('active');
            });
            document.getElementById('content-'+t).classList.remove('hidden');
            document.getElementById('tab-'+t).classList.add('active');
        }

        function calculateAll(e) {
            e.preventDefault();

            // Inputs
            const prodKey = document.getElementById('productType').value;
            const L = parseFloat(document.getElementById('partL').value);
            const W = parseFloat(document.getElementById('partW').value);
            const H = parseFloat(document.getElementById('partH').value);
            const wall = parseFloat(document.getElementById('wallT').value);
            const cavities = parseInt(document.getElementById('cavities').value);
            const steelPrice = parseFloat(document.getElementById('steelPrice').value);
            const matName = document.getElementById('material').value;

            if(!prodKey) { alert("Please select a product"); return; }

            const rule = PROD_RULES[prodKey] || PROD_RULES["default"];
            const mat = MATERIALS[matName];

            // 1. MOLD SIZING
            const insertL = Math.ceil((L + 60)/10)*10;
            const insertW = Math.ceil((W + 60)/10)*10;
            const insertH_A = Math.ceil((H + 40)/10)*10; 
            const insertH_B = Math.ceil((H + 50)/10)*10;

            const cols = Math.ceil(Math.sqrt(cavities)); 
            const rows = Math.ceil(cavities/cols);
            const baseL = Math.ceil((insertL * cols * 1.4)/50)*50;
            const baseW = Math.ceil((insertW * rows * 1.4)/50)*50;

            // 2. STACK
            const t_TC=35, t_Sup=55, t_BC=35;
            const t_A = insertH_A + 25;
            const t_B = insertH_B + 25;
            const stroke = H + 25;
            const spacerH = stroke + 40;

            // 3. BOM
            let totalWt = 0; let cost718 = 0; let costMS = 0;
            const tbody = document.getElementById('bomBody');
            tbody.innerHTML = "";

            const addRow = (item, mat, l, w, h, isHard) => {
                const wt = (l*w*h*0.00000785).toFixed(2);
                const price = isHard ? 850 : steelPrice;
                const cost = wt * price;
                if(isHard) cost718 += cost; else costMS += cost;
                totalWt += parseFloat(wt);
                tbody.innerHTML += `<tr><td>${item}</td><td class="text-xs text-slate-500">${mat}</td><td class="font-mono text-xs">${l}x${w}x${h}</td><td>${wt}</td><td class="text-xs italic text-blue-600">${isHard?"Hardened":"Standard"}</td></tr>`;
            };

            addRow("Core Insert", "718H", insertL, insertW, insertH_B, true);
            addRow("Cavity Insert", "718H", insertL, insertW, insertH_A, true);
            addRow("Top Clamp Plate", "MS", baseL, baseW, t_TC, false);
            addRow("A-Plate", "MS", baseL, baseW, t_A, false);
            addRow("B-Plate", "MS", baseL, baseW, t_B, false);
            addRow("Support Plate", "MS", baseL, baseW, t_Sup, false);
            addRow("Spacer Blocks", "MS", baseL, 70, spacerH, false);
            addRow("Ejector Housing", "MS", baseL-20, baseW-140, 40, false);
            addRow("Bottom Clamp", "MS", baseL, baseW, t_BC, false);

            // 4. SYSTEMS
            const coolDia = baseL > 600 ? "12-16mm" : (baseL > 400 ? "10-12mm" : "8mm");
            const coolOff = baseL > 400 ? "35mm" : "25mm";
            
            const pinDia = wall >= 3 ? "6-8mm" : "4-5mm";
            const pinQty = Math.ceil((2*L+2*W)/60) * cavities;

            // 5. MACHINE
            const reqTon = Math.ceil(L*W*cavities*35/10000);
            let mach = "N/A";
            let alertShow = false;

            if(reqTon > 650) {
                mach = "Needs >650T";
                alertShow = true;
            } else {
                for(let m of MACHINES) { if(m.ton > reqTon*1.2 && baseW < m.bar-50) { mach = m.name; break; }}
                if(mach === "N/A") { mach = "Out of Stock"; alertShow = true; }
            }

            // 6. HARDWARE
            const boltBody = document.getElementById('boltBody');
            boltBody.innerHTML = "";
            const addBolt = (loc, size, plateT, qty) => {
                const len = Math.ceil((plateT + (size==="M16"?24:18))/5)*5;
                const dat = BOLT_DATA[size] || BOLT_DATA["M20"];
                boltBody.innerHTML += `<tr><td>${loc}</td><td class="font-mono font-bold">${size}x${len}</td><td>${qty}</td><td class="text-xs text-orange-600 font-mono">${dat.tap}</td><td class="text-xs text-slate-500">${dat.cb}</td></tr>`;
            };
            const mMain = baseL > 600 ? "M20" : (baseL > 400 ? "M16" : "M12");
            addBolt("Top Clamp > A", mMain, t_TC, 4);
            addBolt("Support > B", mMain, t_Sup, 4);
            addBolt("Inserts", "M10", 30, cavities*4);
            addBolt("Ejector", "M8", 20, 6);


            // UPDATE UI
            document.getElementById('resMachine').innerText = mach;
            document.getElementById('resMachineBig').innerText = mach;
            document.getElementById('resTonnage').innerText = reqTon;
            document.getElementById('resCycle').innerText = Math.ceil(wall*wall*3 + 12);
            document.getElementById('resCost').innerText = Math.ceil(cost718+costMS).toLocaleString();
            document.getElementById('resCostBig').innerText = Math.ceil(cost718+costMS).toLocaleString() + " Tk";
            document.getElementById('resCoolBadge').innerText = rule.cool;

            // Systems Tab
            document.getElementById('resCoolType').innerText = rule.cool;
            document.getElementById('resCoolReason').innerText = rule.reason;
            document.getElementById('resCoolDia').innerText = coolDia;
            document.getElementById('resCoolOff').innerText = coolOff;

            document.getElementById('resGateType').innerText = rule.gate;
            document.getElementById('resGateReason').innerText = rule.gateReason;
            document.getElementById('resSprue').innerText = `Ø${(Math.random()*2+4).toFixed(1)}mm`;
            document.getElementById('resRunner').innerText = `Ø${(Math.random()*3+6).toFixed(1)}mm`;

            document.getElementById('resEjectType').innerText = rule.eject;
            document.getElementById('resStroke').innerText = stroke;

            // Hardware
            document.getElementById('resPinDia').innerText = pinDia;
            document.getElementById('resPinQty').innerText = pinQty;
            document.getElementById('resRetPin').innerText = "4x " + (parseFloat(pinDia)+2) + "mm";
            document.getElementById('resGuide').innerText = "4x Ø" + (baseL>400?30:25) + "mm";

            // Machine Alert
            if(alertShow) document.getElementById('machineAlert').classList.remove('hidden');
            else document.getElementById('machineAlert').classList.add('hidden');

            // Cost Details
            document.getElementById('costInsert').innerText = Math.ceil(cost718).toLocaleString() + " Tk";
            document.getElementById('costBase').innerText = Math.ceil(costMS).toLocaleString() + " Tk";
            document.getElementById('resBaseSize').innerText = `${baseL} x ${baseW}`;

            document.getElementById('welcomeState').classList.add('hidden');
            document.getElementById('resultsArea').classList.remove('hidden');
            showTab('bom');
        }
    </script>
</body>
</html>
